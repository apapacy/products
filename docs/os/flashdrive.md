# Записать запускаемый образ ОС на SD-карту

C ПК на linux

#### Проверка имени флешки

`sudo fdisk -l`

Выдача:
```
...

Диск /dev/mmcblk0: 29 GiB, 31167873024 байтов, 60874752 секторов
Единицы измерения: секторов из 1 * 512 = 512 байтов
Размер сектора (логический/физический): 512 байт / 512 байт
I/O size (minimum/optimal): 512 bytes / 512 bytes
Тип метки диска: dos
Идентификатор диска: 0xeee90448

Устр-во        Загрузочный Start Конец Секторы  Size Id Тип
/dev/mmcblk0p1              8192 60265983 60257792 28,8G 83 Linux

```

В данном случае смотрим, что эта флешка совпадает по размеру с той, что мы вставили. Проверяем, вытащив флешку, что
она пропадает из выдачи fdisk и появляется, когда вставляем ее обратно. 

`Помним` о том, что нужно указывать `имя нужной флешки`, иначе можно потерять данные на неправильном диске.

#### Запись образа

Допустим, мы находимся в домашней директории `~` и тут у нас лежит образ `ubunstu_server_xenial.img`

`sudo dd bs=4M if=ubunstu_server_xenial.img of=/dev/mmcblk0 && sync`

Тут мы убеждаемся, что ввели в `of` адрес именно нашего диска и не отдельной партиции (mmcblk0p1 из примера).

Командой `sync` мы принуждаем операционную систему дописать все на диск. Без нее данные могут записаться до конца не сразу.

#### готово

# Восстановить "запускаемую" флешку для обычного хранения файлов

`Помним` о том, что нужно указывать `имя нужной флешки`, иначе можно потерять данные на неправильном диске.

#### Стираем файловую систему

Стираем файловую систему с флешки:

`sudo wipefs --all /dev/mmcblk0`

Проверяем результат с помощью fdisk:

`sudo fdisk -l`

Выдача: 

```
Диск /dev/mmcblk0: 29 GiB, 31167873024 байтов, 60874752 секторов
Единицы измерения: секторов из 1 * 512 = 512 байтов
Размер сектора (логический/физический): 512 байт / 512 байт
I/O size (minimum/optimal): 512 bytes / 512 bytes
```

видим, что партиций нет.

#### Создаем партицию

`sudo cfdisk /dev/mmcblk0`

- в диалоговом окне выбираем `dos` [вот почему](https://unix.stackexchange.com/questions/235467/arch-linux-cfdisk-asking-for-disk-label-type)
- Потом пункт меню `New`, он предложит нам выбрать размер партиции, оставляем по умолчанию и опять жмем Enter
- Далее выбираем `primary`
- Жмем на пункт меню `Write` и подтверждаем, что мы уверены, вписав `yes` и ткнув Enter
- Выходим с помощью пункта меню `Quit`

проверяем `sudo fdisk -l`

Выдача:

```
Диск /dev/mmcblk0: 29 GiB, 31167873024 байтов, 60874752 секторов
Единицы измерения: секторов из 1 * 512 = 512 байтов
Размер сектора (логический/физический): 512 байт / 512 байт
I/O size (minimum/optimal): 512 bytes / 512 bytes
Тип метки диска: dos
Идентификатор диска: 0x9db9cc20

Устр-во        Загрузочный Start Конец Секторы Size Id Тип
/dev/mmcblk0p1              2048 60874751 60872704  29G 83 Linux
```

Видим партицию `/dev/mmcblk0p1` 

#### Форматируем флешку

Мы выбираем файловую систему [FAT](https://ru.wikipedia.org/wiki/FAT) для нашей партиции:

`sudo mkfs.vfat -n 'MyFlashDrive' /dev/mmcblk0p1`

Где `/dev/mmcblk0p1` - имя партиции, а не диска (окнчается на p1 в моем случае)

'myFlashDrive' - ваше название/метка диска. (При моей метке программа возвращает предупреждение "warning - lowercase labels might not work properly with DOS or Windows", можно назвать ее 'DRIVE', чтобы избежать его)

#### готово

Инструкция является частичным переводом [en]: https://averagelinuxuser.com/how-to-format-bootable-usb-to-normal/ 